getwd()
library(ape)
library(phytools)
library(AICcmodavg)
# Assign correct tree topology to the variable tree, using best tree
tree <- read.newick("RAxML_result.clad_best_tree.out.tre")
# This roots the tree at Pleurobranchaea californica
tree_rooted <- root(tree, "Pleurobranchaea_californica")
# Drop all outgroup tips off of the tree
tree_rooted <- drop.tip(tree_rooted, "Pleurobranchaea_californica")
tree_rooted <- drop.tip(tree_rooted, "Bathydoris_clavigera_A")
tree_rooted <- drop.tip(tree_rooted, "Doris_kerguelenensis")
tree_rooted <- drop.tip(tree_rooted, "Bathydoris_clavigera_B")
# Remove duplicate taxa to minimize bias
tree_rooted <- drop.tip(tree_rooted, "Berghia_stephanieae_B")
tree_rooted <- drop.tip(tree_rooted, "Aeolidia_papillosa_A")
tree_rooted <- drop.tip(tree_rooted, "Anteaeolidiella_chromosoma_B")
tree_rooted <- drop.tip(tree_rooted, "Austraeolis_stearnsi_B")
tree_rooted <- drop.tip(tree_rooted, "Embletonia_pulchra_A")
tree_rooted <- drop.tip(tree_rooted, "Fiona_pinnata_B")
tree_rooted <- drop.tip(tree_rooted, "Hermissenda_sp.")
tree_rooted <- drop.tip(tree_rooted, "Janolus_barbarensis_B")
tree_rooted <- drop.tip(tree_rooted, "Phidiana_lynceus_B")
########################################
# Ancestral state reconstruction - kleptocnides
########################################
# Pull the data matrix of interest into R
morph_data <- read.csv("r_data.csv",stringsAsFactors=FALSE)
# Change any spaces into underscores for species names, then generate a vector with
# the appropriate morph data where the names are set to the species names
morph_data$species <-gsub(" ","_",x=morph_data$species)
morph_vector <- morph_data$kleptocnides
#morph.data2 <- setNames(as.character(morph_vector),morph_data$species)
morph.data2 <- setNames(morph_data$kleptocnides,morph_data$species)
# Check the fit for three different models, ER, SYM and ARD, marginal=FALSE
fitER<-ace(morph.data2,tree_rooted,model="ER",type="discrete",method="ML")
fitSYM<-ace(morph.data2,tree_rooted,model="SYM",type="discrete",method="ML")
fitARD<-ace(morph.data2,tree_rooted,model="ARD",type="discrete",method="ML")
# Log likelihood tests:
# ER to SYM
1-pchisq(2*abs(fitER$loglik - fitSYM$loglik), 1)
# SYM to ARD
1-pchisq(2*abs(fitSYM$loglik - fitARD$loglik), 1)
# ER to ARD
1-pchisq(2*abs(fitER$loglik - fitARD$loglik), 1)
# Calculate the Akaike Information Criterion followed by the AICc, which is a
# correction used for small sample sizes. The second argument is the number of
# estimated parameters in the model. The smaller AICc is the best fit. This is the
# model you should use.
AIC(fitER)
AIC(fitSYM)
AIC(fitARD)
AICcCustom(fitER$loglik, 1, return.K = FALSE, second.ord = TRUE, nobs = 37, c.hat = 1)
AICcCustom(fitSYM$loglik, 1, return.K = FALSE, second.ord = TRUE, nobs = 37, c.hat = 1)
AICcCustom(fitARD$loglik, 1, return.K = FALSE, second.ord = TRUE, nobs = 37, c.hat = 1)
#####
# The ER model is supported as the best fit by AIC, AICc, and likelihood ratio tests
#####
# Create an ultrametric tree with correlated model, output of chronos
# needed to be rewritten using read.tree, then test for ultrametricity
chronotree <- chronos(tree_rooted, lambda=1, model = "correlated")
ultratree <- read.tree(text=write.tree(chronotree))
is.ultrametric(ultratree)
# Set the colors for each set of labels for plotting
cols <- morph_data$color
cols <- setNames(cols, morph_data$species)
colors <- c("purple","green")
# Reordering the vector with the tip colors to match the taxon order in the tree
colsmatch <- match(names(cols),ultratree$tip.label)
cols2 <- cols[order(colsmatch)]
########################################
# Ancestral state reconstruction - distal sacs
########################################
# Pull the data matrix of interest into R
morph_data <- read.csv("r_data.csv",stringsAsFactors=FALSE)
# Change any spaces into underscores for species names, then generate a vector with
# the appropriate morph data where the names are set to the species names
morph_vector2 <- morph_data$sac
morph.data.sac <- setNames(as.character(morph_vector2),morph_data$species)
#morph.data.sac2 <- setNames(morph_data$sac,morph_data$species)
# Check the fit for three different models, ER, SYM and ARD, marginal=FALSE
fitER.sac<-ace(morph.data.sac,tree_rooted,model="ER",type="discrete",method="ML")
fitSYM.sac<-ace(morph.data.sac,tree_rooted,model="SYM",type="discrete",method="ML")
fitARD.sac<-ace(morph.data.sac,tree_rooted,model="ARD",type="discrete",method="ML")
# Log likelihood tests:
# ER to SYM
1-pchisq(2*abs(fitER.sac$loglik - fitSYM$loglik), 1)
# SYM to ARD
1-pchisq(2*abs(fitSYM.sac$loglik - fitARD$loglik), 1)
# ER to ARD
1-pchisq(2*abs(fitER.sac$loglik - fitARD$loglik), 1)
# Calculate the Akaike Information Criterion followed by the AICc, which is a
# correction used for small sample sizes. The second argument is the number of
# estimated parameters in the model. The smaller AICc is the best fit. This is the
# model you should use.
AIC(fitER.sac)
AIC(fitSYM.sac)
AIC(fitARD.sac)
AICcCustom(fitER.sac$loglik, 1, return.K = FALSE, second.ord = TRUE, nobs = 37, c.hat = 1)
AICcCustom(fitSYM.sac$loglik, 1, return.K = FALSE, second.ord = TRUE, nobs = 37, c.hat = 1)
AICcCustom(fitARD.sac$loglik, 1, return.K = FALSE, second.ord = TRUE, nobs = 37, c.hat = 1)
# ARD model is supported as the best fit by AIC, AICc, and likelihood ratio tests
# Set the colors for each set of labels for plotting
cols.sac <- morph_data$color.sac
cols.sac <- setNames(cols.sac, morph_data$species)
colors.sac <- c("blue","yellow")
# Reordering the vector with the tip colors to match the taxon order in the tree
colsmatch.sac <- match(names(cols.sac),ultratree$tip.label)
cols2.sac <- cols.sac[order(colsmatch.sac)]
# Generate an eps file with the correct figure
setEPS()
postscript("ASR_ARD_chars.eps")
plot.phylo(ultratree, label.offset=0.05, edge.width=2.5, cex=0.4)
# tip labels - kleptocnides then sacs
tiplabels(pch=22, bg=cols2, cex=0.8)
tiplabels(pch=22, bg=cols2.sac, adj=0.519, cex=0.8)
# node labels - kleptocnides then sacs
nodelabels(pie=fitARD$lik.anc,piecol=colors,adj=c(0.483,0.5),cex=0.3)
nodelabels(pie=fitARD.sac$lik.anc,piecol=colors.sac,adj=c(0.5,0.5),cex=0.3)
dev.off()
library(ape)
library(phytools)
library(AICcmodavg)
# Assign correct tree topology to the variable tree, using best tree
tree <- read.newick("RAxML_result.clad_best_tree.out.tre")
# This roots the tree at Pleurobranchaea californica
tree_rooted <- root(tree, "Pleurobranchaea_californica")
# Drop all outgroup tips off of the tree
tree_rooted <- drop.tip(tree_rooted, "Pleurobranchaea_californica")
tree_rooted <- drop.tip(tree_rooted, "Bathydoris_clavigera_A")
tree_rooted <- drop.tip(tree_rooted, "Doris_kerguelenensis")
tree_rooted <- drop.tip(tree_rooted, "Bathydoris_clavigera_B")
# Remove duplicate taxa to minimize bias
tree_rooted <- drop.tip(tree_rooted, "Berghia_stephanieae_B")
tree_rooted <- drop.tip(tree_rooted, "Aeolidia_papillosa_A")
tree_rooted <- drop.tip(tree_rooted, "Anteaeolidiella_chromosoma_B")
tree_rooted <- drop.tip(tree_rooted, "Austraeolis_stearnsi_B")
tree_rooted <- drop.tip(tree_rooted, "Embletonia_pulchra_A")
tree_rooted <- drop.tip(tree_rooted, "Fiona_pinnata_B")
tree_rooted <- drop.tip(tree_rooted, "Hermissenda_sp.")
tree_rooted <- drop.tip(tree_rooted, "Janolus_barbarensis_B")
tree_rooted <- drop.tip(tree_rooted, "Phidiana_lynceus_B")
########################################
# Ancestral state reconstruction - kleptocnides
########################################
# Pull the data matrix of interest into R
morph_data <- read.csv("r_data.csv",stringsAsFactors=FALSE)
# Change any spaces into underscores for species names, then generate a vector with
# the appropriate morph data where the names are set to the species names
morph_data$species <-gsub(" ","_",x=morph_data$species)
morph_vector <- morph_data$kleptocnides
#morph.data2 <- setNames(as.character(morph_vector),morph_data$species)
morph.data2 <- setNames(morph_data$kleptocnides,morph_data$species)
# Check the fit for three different models, ER, SYM and ARD, marginal=FALSE
fitER<-ace(morph.data2,tree_rooted,model="ER",type="discrete",method="ML")
fitSYM<-ace(morph.data2,tree_rooted,model="SYM",type="discrete",method="ML")
fitARD<-ace(morph.data2,tree_rooted,model="ARD",type="discrete",method="ML")
# Log likelihood tests:
# ER to SYM
1-pchisq(2*abs(fitER$loglik - fitSYM$loglik), 1)
# SYM to ARD
1-pchisq(2*abs(fitSYM$loglik - fitARD$loglik), 1)
# ER to ARD
1-pchisq(2*abs(fitER$loglik - fitARD$loglik), 1)
# Calculate the Akaike Information Criterion followed by the AICc, which is a
# correction used for small sample sizes. The second argument is the number of
# estimated parameters in the model. The smaller AICc is the best fit. This is the
# model you should use.
AIC(fitER)
AIC(fitSYM)
AIC(fitARD)
AICcCustom(fitER$loglik, 1, return.K = FALSE, second.ord = TRUE, nobs = 37, c.hat = 1)
AICcCustom(fitSYM$loglik, 1, return.K = FALSE, second.ord = TRUE, nobs = 37, c.hat = 1)
AICcCustom(fitARD$loglik, 1, return.K = FALSE, second.ord = TRUE, nobs = 37, c.hat = 1)
#####
# The ER model is supported as the best fit by AIC, AICc, and likelihood ratio tests
#####
# Create an ultrametric tree with correlated model, output of chronos
# needed to be rewritten using read.tree, then test for ultrametricity
chronotree <- chronos(tree_rooted, lambda=1, model = "correlated")
ultratree <- read.tree(text=write.tree(chronotree))
is.ultrametric(ultratree)
# Set the colors for each set of labels for plotting
cols <- morph_data$color
cols <- setNames(cols, morph_data$species)
colors <- c("purple","green")
# Reordering the vector with the tip colors to match the taxon order in the tree
colsmatch <- match(names(cols),ultratree$tip.label)
cols2 <- cols[order(colsmatch)]
########################################
# Ancestral state reconstruction - distal sacs
########################################
# Pull the data matrix of interest into R
morph_data <- read.csv("r_data.csv",stringsAsFactors=FALSE)
# Change any spaces into underscores for species names, then generate a vector with
# the appropriate morph data where the names are set to the species names
morph_vector2 <- morph_data$sac
morph.data.sac <- setNames(as.character(morph_vector2),morph_data$species)
#morph.data.sac2 <- setNames(morph_data$sac,morph_data$species)
# Check the fit for three different models, ER, SYM and ARD, marginal=FALSE
fitER.sac<-ace(morph.data.sac,tree_rooted,model="ER",type="discrete",method="ML")
fitSYM.sac<-ace(morph.data.sac,tree_rooted,model="SYM",type="discrete",method="ML")
fitARD.sac<-ace(morph.data.sac,tree_rooted,model="ARD",type="discrete",method="ML")
# Log likelihood tests:
# ER to SYM
1-pchisq(2*abs(fitER.sac$loglik - fitSYM$loglik), 1)
# SYM to ARD
1-pchisq(2*abs(fitSYM.sac$loglik - fitARD$loglik), 1)
# ER to ARD
1-pchisq(2*abs(fitER.sac$loglik - fitARD$loglik), 1)
# Calculate the Akaike Information Criterion followed by the AICc, which is a
# correction used for small sample sizes. The second argument is the number of
# estimated parameters in the model. The smaller AICc is the best fit. This is the
# model you should use.
AIC(fitER.sac)
AIC(fitSYM.sac)
AIC(fitARD.sac)
AICcCustom(fitER.sac$loglik, 1, return.K = FALSE, second.ord = TRUE, nobs = 37, c.hat = 1)
AICcCustom(fitSYM.sac$loglik, 1, return.K = FALSE, second.ord = TRUE, nobs = 37, c.hat = 1)
AICcCustom(fitARD.sac$loglik, 1, return.K = FALSE, second.ord = TRUE, nobs = 37, c.hat = 1)
# ARD model is supported as the best fit by AIC, AICc, and likelihood ratio tests
# Set the colors for each set of labels for plotting
cols.sac <- morph_data$color.sac
cols.sac <- setNames(cols.sac, morph_data$species)
colors.sac <- c("blue","yellow")
# Reordering the vector with the tip colors to match the taxon order in the tree
colsmatch.sac <- match(names(cols.sac),ultratree$tip.label)
cols2.sac <- cols.sac[order(colsmatch.sac)]
